[manifest]
version = "1.0.0"
priority = 0

[vars]

[[patches]]
[patches.pattern] # Wingdings
target = "functions/common_events.lua"
pattern = "function reset_idol_card()"
position = "before"
payload = '''
function reset_threex_wing_card()
	G.GAME.current_round.threex_wing.rankOne = 'Ace'
	G.GAME.current_round.threex_wing.rankTwo = 'King'
	local valid_cards = {}
    for k, v in ipairs(G.playing_cards) do
        if v.ability.effect ~= 'Stone Card' then
            valid_cards[#valid_cards+1] = v
        end
    end
	if valid_cards[2] then 
        local first_card = pseudorandom_element(valid_cards, pseudoseed('wing'..G.GAME.round_resets.ante))

        G.GAME.current_round.threex_wing.rankOne = first_card.base.value
        G.GAME.current_round.threex_wing.rankOne_id = first_card.base.id

		local next_card = pseudorandom_element(valid_cards, pseudoseed('dings'.. G.GAME.round_resets.ante .. "okayTOREALLYREMOVETHEseededALLEGATIONSIWILLNOWBEPUTTINGTHISINTHISSPECIFICAREAANDTHEREWERENEVERANYseededALLEGATIONSANYWAYIJUSTWANTEDITTONEVEREVERGETTHESAMEIDASTHEOTHERONE"))

        G.GAME.current_round.threex_wing.rankTwo = next_card.base.value
        G.GAME.current_round.threex_wing.rankTwo_id = next_card.base.id
    end
end

'''
match_indent = true


[[patches]]
[patches.pattern] # Wingdings
target = "game.lua"
pattern = "idol_card = {suit = 'Spades', rank = 'Ace'},"
position = "after"
payload = '''
threex_wing = {rankOne = 'Ace', rankTwo = 'King', active = false},
'''
match_indent = true

[[patches]]
[patches.pattern] # Wingdings
target = "card.lua"
pattern = "return self.base.id"
position = "at"
payload = '''
if G.GAME.current_round.threex_wing.active then
	if self.base.id == G.GAME.current_round.threex_wing.rankOne_id then
		return G.GAME.current_round.threex_wing.rankTwo_id

	elseif self.base.id == G.GAME.current_round.threex_wing.rankTwo_id then
		return G.GAME.current_round.threex_wing.rankOne_id

	else
		return self.base.id
	end
end
return self.base.id
'''
match_indent = true

[[patches]]
[patches.pattern] # Wingdings
target = "game.lua"
pattern = "reset_idol_card()"
position = "after"
payload = '''
reset_threex_wing_card()
'''
match_indent = true

[[patches]]
[patches.pattern] # Wingdings
target = "functions/state_events.lua"
pattern = "reset_idol_card()"
position = "after"
payload = '''
reset_threex_wing_card()
'''
match_indent = true